<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.daaaa2d08c2d6ab9f8ba.css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;margin:0;padding:0}h1{font-size:2.25rem}h1,h2{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{margin:0;padding:0}ol,ul{padding:0;margin:0 0 0 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{margin:0;padding:0}pre{margin:0;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{margin:0;padding:0}blockquote{padding:0;margin:0 1.45rem}form,iframe,noscript{margin:0;padding:0}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{margin:0;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{font-family:Dank Mono,SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace}pre code{background:none;line-height:1.42}tt:after,tt:before{letter-spacing:-.2em;content:" "}pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.20.14"/><title data-react-helmet="true">How to break the rules of React Hooks | Inventing With Monster</title><meta data-react-helmet="true" name="description" content="&#x27;Don&#x27;t see limitations, only possibilities.&#x27; ~ Einstein. Or maybe Bruce Lee."/><meta data-react-helmet="true" property="og:title" content="How to break the rules of React Hooks"/><meta data-react-helmet="true" property="og:description" content="&#x27;Don&#x27;t see limitations, only possibilities.&#x27; ~ Einstein. Or maybe Bruce Lee."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@mattgperry"/><meta data-react-helmet="true" name="twitter:title" content="How to break the rules of React Hooks"/><meta data-react-helmet="true" name="twitter:description" content="&#x27;Don&#x27;t see limitations, only possibilities.&#x27; ~ Einstein. Or maybe Bruce Lee."/><meta data-react-helmet="true" name="twitter:image" content="/icons/icon-512x512.png"/><meta data-react-helmet="true" name="keywords" content="matt perry, popmotion, react, pose, popmotion pose, framer, framer motion, ui animation"/><style data-styled="fCCKrg  gUHxeD gAGEbe cmEtnx krLiYu Eswij gDjIGT kIWHnr hTSynM dJGhSF bexhIO" data-styled-version="4.4.1">
/* sc-component-id: header__Container-sc-31ozxh-0 */
.gUHxeD{margin-bottom:100px;} @media (max-width:62em){.gUHxeD{margin-bottom:70px;}} @media (max-width:48em){.gUHxeD{margin-bottom:50px;}} @media (max-width:36em){.gUHxeD{margin-bottom:30px;}}
/* sc-component-id: header__Title-sc-31ozxh-1 */
.gAGEbe a{color:#1fedcb;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;font-size:28px;} @media (max-width:48em){.gAGEbe a{font-size:24px;}} @media (max-width:36em){.gAGEbe a{font-size:18px;}}
/* sc-component-id: bits__Title-dkhe0b-0 */
.cmEtnx{color:#32005c;font-size:72px;font-weight:900;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;text-transform:uppercase;text-align:center;margin-bottom:50px;} @media (max-width:48em){.cmEtnx{font-size:48px;}} @media (max-width:36em){.cmEtnx{text-align:left;font-size:32px;}}
/* sc-component-id: bits__ContentContainer-dkhe0b-1 */
.krLiYu > *{display:block;margin:0 auto;max-width:650px;} .krLiYu > iframe{max-width:700px;} .krLiYu > p{font-size:18px;margin-bottom:25px;line-height:1.6;} .krLiYu > p:first-child{font-size:24px;font-weight:600;line-height:1.4;} .krLiYu > blockquote{border-left:2px solid #1fedcb;padding:20px;background:#f0f0f0;margin-bottom:25px;border-radius:5px;} .krLiYu > ul,.krLiYu > ol{margin-bottom:25px;} .krLiYu h2,.krLiYu h3{color:#31005C;text-transform:uppercase;font-size:36px;margin:50px auto 25px;} .krLiYu h3{font-size:28px;} .krLiYu a{-webkit-text-decoration:none;text-decoration:none;} .krLiYu p code{background:rgba(33,237,203,0.2);padding:5px;border-radius:5px;} .krLiYu .gatsby-highlight{margin-bottom:25px;max-width:700px;} .krLiYu code[class*="language-"],.krLiYu pre[class*="language-"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;white-space:pre-wrap;word-wrap:normal;font-size:16px;text-shadow:none;} .krLiYu pre[class*="language-"],.krLiYu:not(pre)>code[class*="language-"]{background:#333;color:#1fedcb;} .krLiYu pre[class*="language-"]{padding:15px;border-radius:5px;overflow:auto;} .krLiYu pre[class*="language-"]{position:relative;} .krLiYu pre[class*="language-"] code{white-space:pre;display:block;} .krLiYu:not(pre)>code[class*="language-"]{padding:0.15em 0.2em 0.05em;border-radius:.3em;box-shadow:1px 1px 0.3em -0.1em #000 inset;} .krLiYu .token.namespace{opacity:.7;} .krLiYu .token.comment,.krLiYu .token.prolog,.krLiYu .token.doctype,.krLiYu .token.cdata{color:#6f705e;} .krLiYu .token.operator,.krLiYu .token.boolean,.krLiYu .token.number{color:#a77afe;} .krLiYu .token.attr-name,.krLiYu .token.string{color:#FFDE4D;} .krLiYu .token.entity,.krLiYu .token.url,.krLiYu .language-css .token.string,.krLiYu .style .token.string{color:#FFDE4D;} .krLiYu .token.selector,.krLiYu .token.inserted{color:#a6e22d;} .krLiYu .token.atrule,.krLiYu .token.attr-value,.krLiYu .token.keyword,.krLiYu .token.important,.krLiYu .token.deleted{color:#F5148C;} .krLiYu .token.regex,.krLiYu .token.statement{color:#76d9e6;} .krLiYu .token.placeholder,.krLiYu .token.variable{color:#fff;} .krLiYu .token.important,.krLiYu .token.statement,.krLiYu .token.bold{font-weight:bold;} .krLiYu .token.punctuation{color:#bebec5;} .krLiYu .token.entity{cursor:help;} .krLiYu .token.italic{font-style:italic;} .krLiYu code.language-markup{color:#f9f9f9;} .krLiYu code.language-markup .token.tag{color:#F5148C;} .krLiYu code.language-markup .token.attr-name{color:#a6e22d;} .krLiYu code.language-markup .token.attr-value{color:#FFDE4D;} .krLiYu code.language-markup .token.style,.krLiYu code.language-markup .token.script{color:#76d9e6;} .krLiYu code.language-markup .token.script .token.keyword{color:#76d9e6;} .krLiYu pre[class*="language-"][data-line]{position:relative;padding:1em 0 1em 3em;} .krLiYu pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:0;margin-top:1em;background:rgba(255,255,255,0.08);pointer-events:none;line-height:inherit;white-space:pre;} .krLiYu pre[data-line] .line-highlight:before,.krLiYu pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0.2em 0.5em;background-color:rgba(255,255,255,0.4);color:black;font:bold 65%/1 sans-serif;height:1em;line-height:1em;text-align:center;border-radius:999px;text-shadow:none;box-shadow:0 1px 1px rgba(255,255,255,0.7);} .krLiYu pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em;} @media (max-width:48em){.krLiYu > p:first-child{font-size:18px;}.krLiYu h2{font-size:28px;}.krLiYu h3{font-size:18px;}} @media (max-width:36em){.krLiYu h2{font-size:24px;}}
/* sc-component-id: footer__Container-r54yyk-0 */
.dJGhSF{margin-top:40px;border-top:1px solid #eee;padding-bottom:20px;} .dJGhSF p{margin-bottom:10px;}
/* sc-component-id: footer__Avatar-r54yyk-1 */
.bexhIO{width:70px;height:70px;border-radius:50%;margin-right:20px;float:left;} @media (max-width:36em){.bexhIO{width:32px;height:32px;}}
/* sc-component-id: sc-global-2230081131 */
body{padding:10px;background:linear-gradient(180deg,#1fedcb,#31005C);min-height:100vh;} body > *{font-family:'Source Sans Pro',sans-serif;font-weight:400;} body a{color:#F5148C;} body h1,body h1 *,body h2,body h2 *,body h3,body h4,body h5,body h6{font-family:'Raleway',sans-serif;font-weight:900;line-height:0.8;}
/* sc-component-id: layout__Container-ii2kc2-0 */
.fCCKrg{background:#fff;min-height:calc(100vh - 20px);padding:30px;} @media (max-width:48em){.fCCKrg{padding:20px;}} @media (max-width:36em){.fCCKrg{padding:10px;}}
/* sc-component-id: Author__Container-sc-1jp4vsk-0 */
.Eswij{display:-webkit-box !important;display:-webkit-flex !important;display:-ms-flexbox !important;display:flex !important;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;margin-bottom:20px;}
/* sc-component-id: Author__Avatar-sc-1jp4vsk-1 */
.gDjIGT{width:40px;height:40px;border-radius:50%;margin-right:10px;} @media (max-width:36em){.gDjIGT{width:32px;height:32px;}}
/* sc-component-id: Author__Name-sc-1jp4vsk-2 */
.kIWHnr{font-weight:600;}
/* sc-component-id: Author__Seperator-sc-1jp4vsk-3 */
.hTSynM{margin:0 10px;}</style><link href="https://fonts.googleapis.com/css?family=Raleway:900|Source+Sans+Pro:400,600" rel="stylesheet"/><link rel="icon" href="/icons/icon-48x48.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link as="script" rel="preload" href="/framework-8e210829bcc33c32949c.js"/><link as="script" rel="preload" href="/component---src-pages-20190207-break-the-rules-of-react-hooks-mdx-fac95cd3a137f843dfca.js"/><link as="script" rel="preload" href="/commons-ab552edb0dd6beed61a5.js"/><link as="script" rel="preload" href="/styles-b729c27faa6284e9ff45.js"/><link as="script" rel="preload" href="/app-c24af00a5e724c80c77a.js"/><link as="script" rel="preload" href="/05d954cf-920d65011e4c7f301af7.js"/><link as="script" rel="preload" href="/webpack-runtime-5ee161c979ffe4a84bf3.js"/><link as="fetch" rel="preload" href="/page-data/20190207-break-the-rules-of-react-hooks/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Container-ii2kc2-0 fCCKrg"><header class="header__Container-sc-31ozxh-0 gUHxeD"><h2 class="header__Title-sc-31ozxh-1 gAGEbe"><a href="/">Inventing With Monster</a></h2></header><article><h1 class="bits__Title-dkhe0b-0 cmEtnx">How to break the rules of React Hooks</h1><div class="bits__ContentContainer-dkhe0b-1 krLiYu"><div class="Author__Container-sc-1jp4vsk-0 Eswij"><img src="/static/photo-of-matt-perry-78cf3c1b9af9e4daa9e56cc77b940835.jpg" alt="" class="Author__Avatar-sc-1jp4vsk-1 gDjIGT"/><span class="Author__Name-sc-1jp4vsk-2 kIWHnr">Matt Perry</span><span class="Author__Seperator-sc-1jp4vsk-3 hTSynM">|</span>07 Feb 2019</div></div><div class="bits__ContentContainer-dkhe0b-1 krLiYu"><p>React Hooks have finally landed! So many emotions. Here’s a small selection of my own in chronological order: 🧐 🤯 😍</p><p>I’ve been writing a library using Hooks for about three months now, and my final, never-gonna-bother-thinking-further-on-this opinion is that they’re amazing, and can enable you to write equally amazing code.</p><p>Of course, like anything Alanis Morissette mistakenly considers “irony”, something so beautiful can’t exist in this universe without caveats.</p><p>In the case of Hooks, those caveats come in the <a href="https://reactjs.org/docs/hooks-rules.html#explanation">form of rules</a>.</p><p>Today, I want to talk about one in particular. This one:</p><blockquote><p>Only call Hooks at the top level. Don’t call Hooks inside loops, conditions, or nested functions.</p></blockquote><p>Personally, when I saw this rule, I could only think one thing:</p><h2 id="witchcraft" style="position:relative"><a href="#witchcraft" aria-label="witchcraft permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Witchcraft!</h2><p>Why do (what look to be) normal functions have <em>rules</em> around their usage? No loops? No conditions? It must be magic!</p><p>Of course, like most magic, it isn’t actually magic.</p><p>Dan Abramov explains in <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/">more detail on his blog</a>, but the key take-away for us is:</p><ol><li>React knows which component is being rendered at any given time, therefore:</li><li>When a Hook is called, it knows which component is calling it, therefore:</li><li>If we change the calling order of Hooks within a component, React gets confused and breaks, therefore:</li><li><strong>If we want to run Hooks within a loop, or conditionally, we need to abstract them into a stand-alone components</strong>.</li></ol><h2 id="pause-for-thought" style="position:relative"><a href="#pause-for-thought" aria-label="pause for thought permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pause for thought</h2><p>As <a href="https://twitter.com/codehitchhiker">Cher</a> rightfully points out in <a href="https://twitter.com/codehitchhiker/status/1093500712154292224">this tweet</a>:</p><blockquote><p>…you should ask yourself why you’re breaking a rule. Is it because there’s no way to accomplish what you’re trying to do (ie, there’s a gap in the ecosystem that needs properly filled?), or is it because you don’t understand the reasons for the rules?</p></blockquote><p>Are you breaking the rules to genuinely circumvent a technical limitation? Or is React actually saving you from making a serious mistake?</p><p>As <a href="https://twitter.com/dan_abramov/status/1093499692422492161">Dan notes</a>:</p><blockquote><p>…the reason it’s disallowed is not strictly a technical one. It’s that any behavior you could pick would be surprising in some case. Like, when does conditional state reset? What can state inside of an event possibly mean?</p></blockquote><p><code class="language-text">useState</code>, to give one example, provides state <strong>for the lifetime of a component</strong>. It doesn’t make sense to live inside an inline function:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// What now motherfucker?</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">/&gt;</span></span></code></pre></div><p>With that said, in this post I want to concentrate on circumventing the purely <strong>technical</strong> limitations of Hooks, in case you run into any of these situations yourself. We’re not trying to hack anything, just solve your problems in a genuinely “React” way.</p><h2 id="running-hooks-within-a-loop" style="position:relative"><a href="#running-hooks-within-a-loop" aria-label="running hooks within a loop permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Hooks within a loop</h2><p>Firing functions within a loop is one of the first things we learn, so the natural impulse is to do the same with Hooks.</p><p>Consider the following component:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">List</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Loop over items with .map</span>
  <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">/* Do something with ref */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>label<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Looks normal, right? Sober. Well I’ve got news for you buddy. It isn’t.</p><p>The trouble with the above code isn’t that it breaks, it’s <strong>that it works</strong>. Even though we’re using Hooks within a loop it’ll still run just fine on the first render.</p><p>If <code class="language-text">items</code> stays in the same order and the same length, it’ll actually run “just fine” forever, because the order and number of Hooks that the component fires stays consistent.</p><p>But the rule exists because this is way too big an assumption to make. If <code class="language-text">items</code> <strong>does</strong> change in any way, your site or app will break.</p><h3 id="the-solution" style="position:relative"><a href="#the-solution" aria-label="the solution permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The solution</h3><p>As I said somewhere in the dark ages of this post, to fix this we need to abstract the loop’s contents into a component.</p><p>Create a new component, <code class="language-text">Item</code>, that renders out just one of our <code class="language-text">item</code>s:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Item</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Do something with ref */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Render this <code class="language-text">Item</code> component from the loop:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">List</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">label</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>label<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Now, the length and order of <code class="language-text">items</code> can change without our code breaking. Whenever <code class="language-text">Item</code> is rendered, React knows its rendering a <em>different component</em>, and that information is all it needs to correctly keep track of which Hooks are firing where.</p><h2 id="running-hooks-conditionally" style="position:relative"><a href="#running-hooks-conditionally" aria-label="running hooks conditionally permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Hooks conditionally</h2><p>Conditionally firing functions is also one of the first things we learn to do, but you can’t with Hooks.</p><p>Your instinct, though, tells you to write code like this (apologies for the abstract example):</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> enable <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>enable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useFunctionality</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>If <code class="language-text">enable</code> changes, a different number of Hooks are going to be called, and React will throw an error (quite rightfully, you careless charlatan).</p><h3 id="the-solution-1" style="position:relative"><a href="#the-solution-1" aria-label="the solution 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The solution</h3><p>As before, abstract this Hook into a stand-alone component, this one that just returns <code class="language-text">null</code>:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Functionality <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useFunctionality</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>To call this Hook conditionally, we can now render the <code class="language-text">Functionality</code> component conditionally:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> enable <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>enable <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Functionality</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Looking at this, your head might be where mine was when I first realised this method. Your palms are sweaty, probably shaking. You’re reaching for the gin to wash away the nascent guilt.</p><p>This is a natural reaction. Roll through it, until you realise: This approach is actually legit.</p><p>The exact pattern might be slightly novel (although I’m sure it’s been done before), but composing functionality using components couldn’t <em>be</em> more React.</p><p>This method doesn’t work with Hooks that return a variable. But it might be of help if you’re consuming a third-party Hook, or writing a complex one of your own.</p><p>You might be wondering why I didn’t make <code class="language-text">Functionality</code> return <code class="language-text">children</code> and use it like this:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Functionality</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Functionality</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>That’d also be fine, but it doesn’t scale if you’re going to have multiple conditional components. Which is admittedly rare, but if you’re writing a library that exposes lots of functionality through a single, simple component, this might be something you encounter.</p><h2 id="running-hooks-within-a-nested-function" style="position:relative"><a href="#running-hooks-within-a-nested-function" aria-label="running hooks within a nested function permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Hooks within a nested function</h2><p>Seriously? Behave. It’s called a “rule” for a reason yeah?</p><p>(Although if you’re interested, the reason this simply isn’t going to work, ever, is that Hooks require knowledge of what component is currently rendering. Stick a Hook in a function and it could get fired at any time - while a different component is rendering, or even while no component is rendering. And if that happens, well…)</p><h2 id="to-end" style="position:relative"><a href="#to-end" aria-label="to end permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To end</h2><p>Hooks are special but their rules can sometimes feel like they’re limiting your ability to compose complex behaviours.</p><p>When you’re drunk on Hooks it can be difficult to remember how you did things, even yesterday. But fear not! The traditional React way, composing functionality with components, is still the bedrock of how the framework functions.</p></div></article><footer class="bits__ContentContainer-dkhe0b-1 krLiYu"><div class="footer__Container-r54yyk-0 dJGhSF"><h2>About me</h2><img src="/static/photo-of-matt-perry-78cf3c1b9af9e4daa9e56cc77b940835.jpg" alt="" class="footer__Avatar-r54yyk-1 bexhIO"/><p>Hey! I’m Matt Perry. I write<!-- --> <a href="https://framer.com/motion">Framer Motion</a> and take the<!-- --> <a href="https://instagram.com/inventingwithmonster">occasional photo</a>.</p><p><a href="https://twitter.com/mattgperry">Twitter</a> |<!-- --> <a href="https://github.com/inventingwithmonster">Github</a></p></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/20190207-break-the-rules-of-react-hooks/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c24af00a5e724c80c77a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-32411056b4dbf1582694.js"],"component---src-pages-index-js":["/component---src-pages-index-js-03a159949491a192e869.js"],"component---src-pages-20190207-how-to-fix-final-argument-passed-to-useeffect-changed-size-between-renders-mdx":["/component---src-pages-20190207-how-to-fix-final-argument-passed-to-useeffect-changed-size-between-renders-mdx-32ade6316591fd301d17.js"],"component---src-pages-20190207-break-the-rules-of-react-hooks-mdx":["/component---src-pages-20190207-break-the-rules-of-react-hooks-mdx-fac95cd3a137f843dfca.js"],"component---src-pages-20200302-can-i-use-framer-motion-with-styled-components-mdx":["/component---src-pages-20200302-can-i-use-framer-motion-with-styled-components-mdx-015f7b88a20d51799512.js"],"component---src-pages-20190304-how-to-write-a-tween-mdx":["/component---src-pages-20190304-how-to-write-a-tween-mdx-f96e3d29efaedfff1869.js"],"component---src-pages-20200203-animationworklet-the-missing-pieces-mdx":["/component---src-pages-20200203-animationworklet-the-missing-pieces-mdx-3b553de85594d5832680.js"],"component---src-pages-20200409-inside-magic-motion-mdx":["/component---src-pages-20200409-inside-magic-motion-mdx-bc018becc0aa396adf85.js"]};/*]]>*/</script><script src="/webpack-runtime-5ee161c979ffe4a84bf3.js" async=""></script><script src="/05d954cf-920d65011e4c7f301af7.js" async=""></script><script src="/app-c24af00a5e724c80c77a.js" async=""></script><script src="/styles-b729c27faa6284e9ff45.js" async=""></script><script src="/commons-ab552edb0dd6beed61a5.js" async=""></script><script src="/component---src-pages-20190207-break-the-rules-of-react-hooks-mdx-fac95cd3a137f843dfca.js" async=""></script><script src="/framework-8e210829bcc33c32949c.js" async=""></script></body></html>