<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.daaaa2d08c2d6ab9f8ba.css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;margin:0;padding:0}h1{font-size:2.25rem}h1,h2{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{margin:0;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{margin:0;padding:0}ol,ul{padding:0;margin:0 0 0 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{margin:0;padding:0}pre{margin:0;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{margin:0;padding:0}blockquote{padding:0;margin:0 1.45rem}form,iframe,noscript{margin:0;padding:0}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{margin:0;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{font-family:Dank Mono,SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace}pre code{background:none;line-height:1.42}tt:after,tt:before{letter-spacing:-.2em;content:" "}pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.20.14"/><title data-react-helmet="true">The Magic Inside Magic Motion | Inventing With Monster</title><meta data-react-helmet="true" name="description" content="Magic Motion is a powerful new feature in Framer that can automatically animate between any two screens. Let&#x27;s discover how it animates layouts at 60fps."/><meta data-react-helmet="true" property="og:title" content="The Magic Inside Magic Motion"/><meta data-react-helmet="true" property="og:description" content="Magic Motion is a powerful new feature in Framer that can automatically animate between any two screens. Let&#x27;s discover how it animates layouts at 60fps."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@mattgperry"/><meta data-react-helmet="true" name="twitter:title" content="The Magic Inside Magic Motion"/><meta data-react-helmet="true" name="twitter:description" content="Magic Motion is a powerful new feature in Framer that can automatically animate between any two screens. Let&#x27;s discover how it animates layouts at 60fps."/><meta data-react-helmet="true" name="twitter:image" content="/icons/icon-512x512.png"/><meta data-react-helmet="true" name="keywords" content="matt perry, popmotion, react, pose, popmotion pose, framer, framer motion, ui animation"/><style data-styled="fCCKrg  gUHxeD gAGEbe cmEtnx krLiYu Eswij gDjIGT kIWHnr hTSynM fNFvTx fcVDZj cUxEJQ gNvflW hWsWGX cVTKrm cieVwI imbfAD dJGhSF bexhIO" data-styled-version="4.4.1">
/* sc-component-id: examples__Example-sc-3aubv9-0 */
.fNFvTx{width:100%;max-width:700px !important;height:300px;border:1px solid #eee;display:-webkit-box !important;display:-webkit-flex !important;display:-ms-flexbox !important;display:flex !important;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;border-radius:5px;margin-bottom:25px !important;}
/* sc-component-id: Switch__Container-sc-1c110ji-0 */
.fcVDZj{width:170px;height:100px;border-radius:100px;padding:10px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;cursor:pointer;background-color:#dddddd;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;}
/* sc-component-id: Switch__Handle-sc-1c110ji-1 */
.cUxEJQ{width:80px;height:80px;background-color:#ffffff;border-radius:200px;box-shadow:1px 2px 3px rgba(0,0,0,0.02);}
/* sc-component-id: Distortion__Container-sc-2u6zrg-0 */
.cieVwI{background-color:#eeeeee;border-radius:25px;margin:0;padding:20px;width:80%;}
/* sc-component-id: Distortion__Ball-sc-2u6zrg-1 */
.imbfAD{background:#f5148c;border-radius:50%;width:50px;height:50px;}
/* sc-component-id: Distortion__Box-sc-2u6zrg-2 */
.gNvflW{width:100px;height:100px;border-radius:30px;background:#ddd;padding:10px;}
/* sc-component-id: Distortion__Child-sc-2u6zrg-3 */
.hWsWGX{background-color:#31005C;width:50px;height:50px;border-radius:20px;}
/* sc-component-id: ShadowRatio__Box-sc-1mt3dke-0 */
.cVTKrm{width:100px;height:100px;border-radius:20px;background:#fff;box-shadow:0 20px 40px rgba(0,0,0,0.2);}
/* sc-component-id: header__Container-sc-31ozxh-0 */
.gUHxeD{margin-bottom:100px;} @media (max-width:62em){.gUHxeD{margin-bottom:70px;}} @media (max-width:48em){.gUHxeD{margin-bottom:50px;}} @media (max-width:36em){.gUHxeD{margin-bottom:30px;}}
/* sc-component-id: header__Title-sc-31ozxh-1 */
.gAGEbe a{color:#1fedcb;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;font-size:28px;} @media (max-width:48em){.gAGEbe a{font-size:24px;}} @media (max-width:36em){.gAGEbe a{font-size:18px;}}
/* sc-component-id: bits__Title-dkhe0b-0 */
.cmEtnx{color:#32005c;font-size:72px;font-weight:900;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;text-transform:uppercase;text-align:center;margin-bottom:50px;} @media (max-width:48em){.cmEtnx{font-size:48px;}} @media (max-width:36em){.cmEtnx{text-align:left;font-size:32px;}}
/* sc-component-id: bits__ContentContainer-dkhe0b-1 */
.krLiYu > *{display:block;margin:0 auto;max-width:650px;} .krLiYu > iframe{max-width:700px;} .krLiYu > p{font-size:18px;margin-bottom:25px;line-height:1.6;} .krLiYu > p:first-child{font-size:24px;font-weight:600;line-height:1.4;} .krLiYu > blockquote{border-left:2px solid #1fedcb;padding:20px;background:#f0f0f0;margin-bottom:25px;border-radius:5px;} .krLiYu > ul,.krLiYu > ol{margin-bottom:25px;} .krLiYu h2,.krLiYu h3{color:#31005C;text-transform:uppercase;font-size:36px;margin:50px auto 25px;} .krLiYu h3{font-size:28px;} .krLiYu a{-webkit-text-decoration:none;text-decoration:none;} .krLiYu p code{background:rgba(33,237,203,0.2);padding:5px;border-radius:5px;} .krLiYu .gatsby-highlight{margin-bottom:25px;max-width:700px;} .krLiYu code[class*="language-"],.krLiYu pre[class*="language-"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;white-space:pre-wrap;word-wrap:normal;font-size:16px;text-shadow:none;} .krLiYu pre[class*="language-"],.krLiYu:not(pre)>code[class*="language-"]{background:#333;color:#1fedcb;} .krLiYu pre[class*="language-"]{padding:15px;border-radius:5px;overflow:auto;} .krLiYu pre[class*="language-"]{position:relative;} .krLiYu pre[class*="language-"] code{white-space:pre;display:block;} .krLiYu:not(pre)>code[class*="language-"]{padding:0.15em 0.2em 0.05em;border-radius:.3em;box-shadow:1px 1px 0.3em -0.1em #000 inset;} .krLiYu .token.namespace{opacity:.7;} .krLiYu .token.comment,.krLiYu .token.prolog,.krLiYu .token.doctype,.krLiYu .token.cdata{color:#6f705e;} .krLiYu .token.operator,.krLiYu .token.boolean,.krLiYu .token.number{color:#a77afe;} .krLiYu .token.attr-name,.krLiYu .token.string{color:#FFDE4D;} .krLiYu .token.entity,.krLiYu .token.url,.krLiYu .language-css .token.string,.krLiYu .style .token.string{color:#FFDE4D;} .krLiYu .token.selector,.krLiYu .token.inserted{color:#a6e22d;} .krLiYu .token.atrule,.krLiYu .token.attr-value,.krLiYu .token.keyword,.krLiYu .token.important,.krLiYu .token.deleted{color:#F5148C;} .krLiYu .token.regex,.krLiYu .token.statement{color:#76d9e6;} .krLiYu .token.placeholder,.krLiYu .token.variable{color:#fff;} .krLiYu .token.important,.krLiYu .token.statement,.krLiYu .token.bold{font-weight:bold;} .krLiYu .token.punctuation{color:#bebec5;} .krLiYu .token.entity{cursor:help;} .krLiYu .token.italic{font-style:italic;} .krLiYu code.language-markup{color:#f9f9f9;} .krLiYu code.language-markup .token.tag{color:#F5148C;} .krLiYu code.language-markup .token.attr-name{color:#a6e22d;} .krLiYu code.language-markup .token.attr-value{color:#FFDE4D;} .krLiYu code.language-markup .token.style,.krLiYu code.language-markup .token.script{color:#76d9e6;} .krLiYu code.language-markup .token.script .token.keyword{color:#76d9e6;} .krLiYu pre[class*="language-"][data-line]{position:relative;padding:1em 0 1em 3em;} .krLiYu pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:0;margin-top:1em;background:rgba(255,255,255,0.08);pointer-events:none;line-height:inherit;white-space:pre;} .krLiYu pre[data-line] .line-highlight:before,.krLiYu pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0.2em 0.5em;background-color:rgba(255,255,255,0.4);color:black;font:bold 65%/1 sans-serif;height:1em;line-height:1em;text-align:center;border-radius:999px;text-shadow:none;box-shadow:0 1px 1px rgba(255,255,255,0.7);} .krLiYu pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em;} @media (max-width:48em){.krLiYu > p:first-child{font-size:18px;}.krLiYu h2{font-size:28px;}.krLiYu h3{font-size:18px;}} @media (max-width:36em){.krLiYu h2{font-size:24px;}}
/* sc-component-id: footer__Container-r54yyk-0 */
.dJGhSF{margin-top:40px;border-top:1px solid #eee;padding-bottom:20px;} .dJGhSF p{margin-bottom:10px;}
/* sc-component-id: footer__Avatar-r54yyk-1 */
.bexhIO{width:70px;height:70px;border-radius:50%;margin-right:20px;float:left;} @media (max-width:36em){.bexhIO{width:32px;height:32px;}}
/* sc-component-id: sc-global-2230081131 */
body{padding:10px;background:linear-gradient(180deg,#1fedcb,#31005C);min-height:100vh;} body > *{font-family:'Source Sans Pro',sans-serif;font-weight:400;} body a{color:#F5148C;} body h1,body h1 *,body h2,body h2 *,body h3,body h4,body h5,body h6{font-family:'Raleway',sans-serif;font-weight:900;line-height:0.8;}
/* sc-component-id: layout__Container-ii2kc2-0 */
.fCCKrg{background:#fff;min-height:calc(100vh - 20px);padding:30px;} @media (max-width:48em){.fCCKrg{padding:20px;}} @media (max-width:36em){.fCCKrg{padding:10px;}}
/* sc-component-id: Author__Container-sc-1jp4vsk-0 */
.Eswij{display:-webkit-box !important;display:-webkit-flex !important;display:-ms-flexbox !important;display:flex !important;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;margin-bottom:20px;}
/* sc-component-id: Author__Avatar-sc-1jp4vsk-1 */
.gDjIGT{width:40px;height:40px;border-radius:50%;margin-right:10px;} @media (max-width:36em){.gDjIGT{width:32px;height:32px;}}
/* sc-component-id: Author__Name-sc-1jp4vsk-2 */
.kIWHnr{font-weight:600;}
/* sc-component-id: Author__Seperator-sc-1jp4vsk-3 */
.hTSynM{margin:0 10px;}</style><link href="https://fonts.googleapis.com/css?family=Raleway:900|Source+Sans+Pro:400,600" rel="stylesheet"/><link rel="icon" href="/icons/icon-48x48.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=843c0ed8b505221a19ec3e6918fd0e74"/><link as="script" rel="preload" href="/framework-8e210829bcc33c32949c.js"/><link as="script" rel="preload" href="/component---src-pages-20200409-inside-magic-motion-mdx-502078a86296f1ef4d06.js"/><link as="script" rel="preload" href="/commons-ab552edb0dd6beed61a5.js"/><link as="script" rel="preload" href="/styles-b729c27faa6284e9ff45.js"/><link as="script" rel="preload" href="/app-c24af00a5e724c80c77a.js"/><link as="script" rel="preload" href="/05d954cf-920d65011e4c7f301af7.js"/><link as="script" rel="preload" href="/webpack-runtime-1bfe16626b8ae7a67aaa.js"/><link as="fetch" rel="preload" href="/page-data/20200409-inside-magic-motion/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Container-ii2kc2-0 fCCKrg"><header class="header__Container-sc-31ozxh-0 gUHxeD"><h2 class="header__Title-sc-31ozxh-1 gAGEbe"><a href="/">Inventing With Monster</a></h2></header><article><h1 class="bits__Title-dkhe0b-0 cmEtnx">The Magic Inside Magic Motion</h1><div class="bits__ContentContainer-dkhe0b-1 krLiYu"><div class="Author__Container-sc-1jp4vsk-0 Eswij"><img src="/static/photo-of-matt-perry-78cf3c1b9af9e4daa9e56cc77b940835.jpg" alt="" class="Author__Avatar-sc-1jp4vsk-1 gDjIGT"/><span class="Author__Name-sc-1jp4vsk-2 kIWHnr">Matt Perry</span><span class="Author__Seperator-sc-1jp4vsk-3 hTSynM">|</span>09 Apr 2020</div></div><div class="bits__ContentContainer-dkhe0b-1 krLiYu"><p>Magic Motion is a powerful new feature in <a href="https://framer.com">Framer</a> that allows designers to link any two frames and smoothly animate between them.</p><p>Magic Motion is built on the new <a href="https://framer.com/api/motion/animation/#automatic-(beta)">auto-animate</a> and <a href="https://framer.com/api/motion/animate-shared-layout">shared layout</a> features in Framer Motion 2. So as a developer, handoff isn’t a pit-of-the-stomach experience, or a hasty “you can’t do that on the web!”</p><p>Implementing a Magic Motion prototype as a production-ready, URL-driven animation between completely different views is just a few lines of React markup:</p><iframe src="https://codesandbox.io/embed/framer-motion-magic-motion-app-store-demo-su6mx?fontsize=14&amp;theme=light" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden;margin-bottom:40px" title="Framer Motion: Magic Motion App Store demo" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>Crucially, Framer Motion performs all these layout animations at 60fps. In this this post, we’re going to learn how.</p><h2 id="the-problem" style="position:relative"><a href="#the-problem" aria-label="the problem permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Problem</h2><p>CSS offers a number of different layout systems, that are all compatible with each other. A flexbox could be placed with in an absolutely positioned grid that sits within a static <code class="language-text">float: right</code>.</p><p>With all these possibilities, calculating how a webpage should look is expensive. At 60fps a browser has just 16.6 milliseconds to update the screen before the next frame. It’s unlikely, and this is why browsers don’t offer a way to animate layout.</p><p>Take this switch, which is laid out using a simple flexbox. Even with <code class="language-text">transition: all</code>, changing <code class="language-text">justify-content</code> has an instant effect:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="Switch__Container-sc-1c110ji-0 fcVDZj"><div class="Switch__Handle-sc-1c110ji-1 cUxEJQ"></div></div></div><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token punctuation">.</span>switch <span class="token punctuation">{</span>
  justify<span class="token operator">-</span>content<span class="token operator">:</span> align<span class="token operator">-</span>start<span class="token punctuation">;</span>
  transition<span class="token operator">:</span> all<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>switch<span class="token punctuation">.</span>on <span class="token punctuation">{</span>
  justify<span class="token operator">-</span>content<span class="token operator">:</span> align<span class="token operator">-</span>end<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>So front-end developers are limited in their options. Ideally, using only <a href="https://csstriggers.com/">compositable properties</a> like <code class="language-text">transform</code> and <code class="language-text">opacity</code>. Properties like <code class="language-text">background-color</code> and <code class="language-text">box-shadow</code> trigger paint, which isn’t ideal, but sometimes it’s unavoidable.</p><p>What we ideally want then, is a way of animating layout using only transforms.</p><h2 id="flip" style="position:relative"><a href="#flip" aria-label="flip permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FLIP</h2><p>The technique at the core of performant layout transitions in the browser was first described by <a href="https://aerotwist.com/blog/flip-your-animations/">Paul Lewis</a>.</p><p>It’s called FLIP, which stands for <strong>F</strong>irst, <strong>L</strong>ast, <strong>I</strong>nvert, <strong>P</strong>lay.</p><p>That is, we:</p><ol><li>Measure the first layout</li><li>Update the CSS and measure the last layout</li><li>Apply the inverted delta as a <code class="language-text">transform</code> to make the last layout look like the first</li><li>Play the animation</li></ol><p>So we do the expensive thing (layout) at the start of the animation, where we have a window of time where the user won’t notice heavy work. Then we do the cheap thing (animating <code class="language-text">transform</code>) once per frame.</p><p>For very simple use-cases, this is enough to smoothly animate layout:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="Switch__Container-sc-1c110ji-0 fcVDZj"><div class="Switch__Handle-sc-1c110ji-1 cUxEJQ"></div></div></div><p>But there’s a drawback to FLIP that can instantly wreck the illusion. <strong>Scale distortion</strong>.</p><p>By replacing the animation of <code class="language-text">width</code> and <code class="language-text">height</code> with <code class="language-text">scaleX</code> and <code class="language-text">scaleY</code>, everything style that was bound to that width and height is visibly broken. This includes <code class="language-text">box-shadow</code>, <code class="language-text">border-radius</code>, and the size and styles of any children too.</p><p>Try clicking on this box and notice the types of distortions seen when toggling between its two visual states.</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div style="transform:scale(4) translateZ(0)" class="Distortion__Box-sc-2u6zrg-2 gNvflW"><div class="Distortion__Child-sc-2u6zrg-3 hWsWGX"></div></div></div><p>Magic Motion’s key innovation is the ability to correct all of this visual distortion, throughout an infinitely deep tree:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="Distortion__Box-sc-2u6zrg-2 gNvflW"><div class="Distortion__Child-sc-2u6zrg-3 hWsWGX"></div></div></div><p>This is <strong>scale correction</strong>. We apply it to CSS properties that can be corrected without triggering layout, like <code class="language-text">box-shadow</code> and <code class="language-text">border-radius</code>, and we apply it throughout a tree on any component that a user has set to automatically animate.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>motion.div</span> <span class="token attr-name">animate</span> <span class="token punctuation">/&gt;</span></span></code></pre></div><h2 id="correcting-css-styles" style="position:relative"><a href="#correcting-css-styles" aria-label="correcting css styles permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Correcting CSS Styles</h2><p>Correcting the appearance of <code class="language-text">border-radius</code> and <code class="language-text">box-shadow</code> is a three step process.</p><p>First, if we’re animating between two different values, we interpolate between those.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> borderRadius <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>Second, we keep a record of the “actual”, pre-correction value. This in case the animation is interrupted we can start from this, rather than the scale-corrected value (which might have no relevance in a future FLIP scale).</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>borderRadius <span class="token operator">=</span> borderRadius<span class="token punctuation">;</span></code></pre></div><p>Finally, we apply the scale correction.</p><p>The <code class="language-text">border-radius</code> style can be set per-corner with styles like <code class="language-text">border-top-left-radius</code>. Each corner can accept two values, one for each axis. So to correct for each axis, we divide the current <code class="language-text">border-radius</code> once by the scale of each.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> x <span class="token operator">=</span> borderRadius <span class="token operator">/</span> scaleX<span class="token punctuation">;</span>
<span class="token keyword">const</span> y <span class="token operator">=</span> borderRadius <span class="token operator">/</span> scaleY<span class="token punctuation">;</span>
<span class="token function">setBorderRadius</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p><code class="language-text">box-shadow</code> has an <code class="language-text">x</code> and <code class="language-text">y</code> setting that be corrected in the same way, but it also has <code class="language-text">blur</code> and <code class="language-text">spread</code> that don’t have single-axis controls. To correct these values, we have to take an average scale and apply that to both instead:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> averageScale <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>scaleX<span class="token punctuation">,</span> scaleY<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
blur <span class="token operator">=</span> blur <span class="token operator">/</span> averageScale<span class="token punctuation">;</span>
spread <span class="token operator">=</span> spread <span class="token operator">/</span> averageScale<span class="token punctuation">;</span></code></pre></div><p>This works pretty well but it isn’t perfect. The limitations of this approach are increasingly obvious with more extreme ratios of x/y distortion:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="ShadowRatio__Box-sc-1mt3dke-0 cVTKrm"></div></div><p>But generally the ratios we animate from/to are usually similar enough that the <code class="language-text">blur</code> and <code class="language-text">spread</code> scale correction looks pretty good, and in the future there may be some weighting we can do to stop the more extreme distortions.</p><p>Correcting these two styles fixes most of the visual distortion on a component. But we’re still left with the distortion of children.</p><h2 id="correcting-child-components" style="position:relative"><a href="#correcting-child-components" aria-label="correcting child components permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Correcting Child Components</h2><p>Without child correction, the shape of this round ball becomes distorted as its parent changes <code class="language-text">scaleX</code>:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="Distortion__Container-sc-2u6zrg-0 cieVwI"><div class="Distortion__Ball-sc-2u6zrg-1 imbfAD"></div></div></div><p>It would be impossible to try and predictably animate this ball’s <code class="language-text">x</code> position, as the space it travelled through would itself be stretching and squashing.</p><p>Correcting distortion is where we start to pull away from the literal technique of FLIP and adhere to it more in principle.</p><p>The first step is to loop through every animating component and remove any currently animating styles. Then, we snapshot their last layout in a second run.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> child<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> child<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>By batching the reads and writes in this way we firstly prevent <a href="https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing">layout thrashing</a>. In Framer, a prototype might have hundreds of animating components, so optimising this can have a profound effect on performance.</p><p>We also ensure we’re snapshotting every component as it will exist on the screen in its final state, unaffected by the <code class="language-text">transform</code> of its parent(s).</p><p>This is important, because it means we can then track, within a tree, all of the transforms we’ve applied to each component, then use this to correct the appearance of its children.</p><p>Because we want to play the animation of every component independently of this tree transform, each component has a shadow bounding box. This gets interpolated from its visual origin to its target once per frame.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> latest <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>The <code class="language-text">target</code> is <strong>usually</strong> the same as the measured last layout (the <strong>L</strong> in FLIP), but for some effects like <code class="language-text">AnimateSharedLayout</code>’s crossfade it might be somewhere else on screen. Either way, we now know where on the screen we want our component to appear visually.</p><p>We use this information to calculate the delta between where we want the component to appear, and where it actually is.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token function">calcDelta</span><span class="token punctuation">(</span>latest<span class="token punctuation">,</span> actualPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>The component saves this <code class="language-text">delta</code> to a context that all of its children have access to. The component itself might also have some parent deltas that it has to correct for. So before calculating <code class="language-text">delta</code> we first apply all the latest parent deltas to the actual measured position.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> latest <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transformedPosition <span class="token operator">=</span> <span class="token function">applyParentDeltas</span><span class="token punctuation">(</span>actualPosition<span class="token punctuation">,</span> parentDeltas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token function">calcDelta</span><span class="token punctuation">(</span>latest<span class="token punctuation">,</span> transformedPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>This is how the scale correction is performed. By applying <code class="language-text">parentDeltas</code> to the actual position, we are then just left with figuring out how to get from there to our desired visual position.</p><p>As a final step, we also use <code class="language-text">parentDeltas</code> to calculate the combined scale of the tree. We can use this on the CSS style corrections from before, so they correct parent distortions too:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> x <span class="token operator">=</span> borderRadius <span class="token operator">/</span> scaleX <span class="token operator">/</span> treeScaleX<span class="token punctuation">;</span></code></pre></div><p>Our ball now stays the correct size, and can animate through scaled space even as it distorts around it:</p><div class="examples__Example-sc-3aubv9-0 fNFvTx"><div class="Distortion__Container-sc-2u6zrg-0 cieVwI"><div class="Distortion__Ball-sc-2u6zrg-1 imbfAD"></div></div></div><h2 id="conclusion" style="position:relative"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2><p>Animating layout in the browser is hard, but Framer and Framer Motion are presenting it in an accessible way, removing all the friction from handoff.</p><p>Thanks to the foundations of the FLIP technique, we can so performantly, too. By accounting for tree transformations, its possible to correct scale distortions throughout an infinitely deep tree, on size, position and even CSS styles like <code class="language-text">box-shadow</code> and <code class="language-text">border-radius</code>.</p><p>If you’re a designer, sign up for the <a href="https://www.framer.com/web/">Framer beta</a>, and if you’re a developer you can try out the new <!-- -->[auto-animate]<!-- -->(&lt;<a href="https://framer.com/api/motion/animation/#automatic-(beta)">https://framer.com/api/motion/animation/#automatic-(beta)</a>) and <a href="https://framer.com/api/motion/animate-shared-layout">shared layout</a> features in the Framer Motion 2 open beta right now!</p></div></article><footer class="bits__ContentContainer-dkhe0b-1 krLiYu"><div class="footer__Container-r54yyk-0 dJGhSF"><h2>About me</h2><img src="/static/photo-of-matt-perry-78cf3c1b9af9e4daa9e56cc77b940835.jpg" alt="" class="footer__Avatar-r54yyk-1 bexhIO"/><p>Hey! I’m Matt Perry. I write<!-- --> <a href="https://framer.com/motion">Framer Motion</a> and take the<!-- --> <a href="https://instagram.com/inventingwithmonster">occasional photo</a>.</p><p><a href="https://twitter.com/mattgperry">Twitter</a> |<!-- --> <a href="https://github.com/inventingwithmonster">Github</a></p></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/20200409-inside-magic-motion/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c24af00a5e724c80c77a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-32411056b4dbf1582694.js"],"component---src-pages-index-js":["/component---src-pages-index-js-03a159949491a192e869.js"],"component---src-pages-20190207-how-to-fix-final-argument-passed-to-useeffect-changed-size-between-renders-mdx":["/component---src-pages-20190207-how-to-fix-final-argument-passed-to-useeffect-changed-size-between-renders-mdx-32ade6316591fd301d17.js"],"component---src-pages-20190207-break-the-rules-of-react-hooks-mdx":["/component---src-pages-20190207-break-the-rules-of-react-hooks-mdx-fac95cd3a137f843dfca.js"],"component---src-pages-20200302-can-i-use-framer-motion-with-styled-components-mdx":["/component---src-pages-20200302-can-i-use-framer-motion-with-styled-components-mdx-015f7b88a20d51799512.js"],"component---src-pages-20190304-how-to-write-a-tween-mdx":["/component---src-pages-20190304-how-to-write-a-tween-mdx-f96e3d29efaedfff1869.js"],"component---src-pages-20200203-animationworklet-the-missing-pieces-mdx":["/component---src-pages-20200203-animationworklet-the-missing-pieces-mdx-3b553de85594d5832680.js"],"component---src-pages-20200409-inside-magic-motion-mdx":["/component---src-pages-20200409-inside-magic-motion-mdx-502078a86296f1ef4d06.js"]};/*]]>*/</script><script src="/webpack-runtime-1bfe16626b8ae7a67aaa.js" async=""></script><script src="/05d954cf-920d65011e4c7f301af7.js" async=""></script><script src="/app-c24af00a5e724c80c77a.js" async=""></script><script src="/styles-b729c27faa6284e9ff45.js" async=""></script><script src="/commons-ab552edb0dd6beed61a5.js" async=""></script><script src="/component---src-pages-20200409-inside-magic-motion-mdx-502078a86296f1ef4d06.js" async=""></script><script src="/framework-8e210829bcc33c32949c.js" async=""></script></body></html>