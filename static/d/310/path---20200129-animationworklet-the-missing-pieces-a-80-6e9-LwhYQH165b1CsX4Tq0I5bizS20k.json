{"data":{"markdownRemark":{"html":"<p>The upcoming <a href=\"https://developers.google.com/web/updates/2018/10/animation-worklet\">Animation Worklet</a> is part of an interweaving suite of APIs collectively called CSS Houdini. They’ll offer developers low-level access to various parts of the browser’s rendering engine like paint, layout, and of relevance to us: Animation.</p>\n<p>I’ve spent six years writing animation libraries like <a href=\"https://popmotion.io/pure\">Popmotion</a> and <a href=\"https://framer.com/motion\">Framer Motion</a> in an attempt to push web UI animations beyond simple easing curves. These libraries, and others like them, wouldn’t need to exist if browsers already offered physics-based animations.</p>\n<p>But they don’t.</p>\n<p>I’ve always found this fact frustrating, but Animation Worklet is potentially a far better solution than covering just this one use-case.</p>\n<p>If it reaches its full potential, the API will a silver bullet, offering developers a way to blend time and user input to write animations and gestures that run entirely outside of the main thread.</p>\n<p>This means that the code running the animations won’t be the cause of slow-down in other parts of your app. And if there is slow-down, they won’t suffer visual jank.</p>\n<p>But that’s <strong>if</strong> the API reaches its full potential. And as far as “if”s go, I put that one in bold.</p>\n<p>A quick glance at <a href=\"http://ishoudinireadyyet.com/\">Is Houdini Ready Yet?</a> shows that Animation Worklet suffers some of the poorest support of all the Houdini APIs. For good reason: It isn’t fully specced yet, and what has been specced falls far short of what I would consider an MVP.</p>\n<p>In this post we’re going to take a</p>\n<hr>\n<h2 id=\"101\"><a href=\"#101\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>101</h2>\n<p><code class=\"language-text\">chrome://flags</code> Experimental Web Platform features</p>\n<p>If you are familiar with the Animation Worklet API, feel free to skip this section.</p>\n<h2 id=\"i-am-finished\"><a href=\"#i-am-finished\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I am finished</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">documentTimeline<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://github.com/w3c/css-houdini-drafts/issues/808\">https://github.com/w3c/css-houdini-drafts/issues/808</a></p>\n<h2 id=\"velocity\"><a href=\"#velocity\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Velocity</h2>\n<p>Unanswered <a href=\"https://github.com/w3c/css-houdini-drafts/issues/976\">issue</a></p>\n<p>Access to a timestamped history of resolved values for any given animated value.</p>\n<h2 id=\"pointer-events\"><a href=\"#pointer-events\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pointer events</h2>\n<p><a href=\"https://github.com/w3c/css-houdini-drafts/issues/834\">https://github.com/w3c/css-houdini-drafts/issues/834</a></p>\n<h2 id=\"unclamped-timelines\"><a href=\"#unclamped-timelines\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unclamped timelines</h2>\n<p>It’s not even possible to support over or under-shoot easing.</p>\n<p>In theory, it would be possible to write a library that could give any provided target extra “headroom” on either side.</p>\n<p>For instance, to animate between <code class=\"language-text\">0</code> and <code class=\"language-text\">100</code> with an easing function that overshoots</p>\n<p><a href=\"https://github.com/GoogleChromeLabs/houdini-samples/blob/master/animation-worklet/spring-timing/index.html#L68\">https://github.com/GoogleChromeLabs/houdini-samples/blob/master/animation-worklet/spring-timing/index.html#L68</a></p>\n<p>Problem with this approach is it works great between values of the same type\nbut one of the true benefits of these brwoser animation APIs is animating between value types</p>\n<p>x: “500px”\nx: “50vw”</p>\n<p>What if 500px is to the left of the element and 100vw is to the right?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Main thread</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> origin<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> duration<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WorkletAnimation</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"tween\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">KeyframeEffect</span><span class=\"token punctuation\">(</span>\n      element<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token string\">\"--x\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>origin<span class=\"token punctuation\">,</span> target <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> duration<span class=\"token punctuation\">:</span> duration <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    document<span class=\"token punctuation\">.</span>timeline\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Worklet</span>\n<span class=\"token function\">registerAnimation</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"tween\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">animate</span><span class=\"token punctuation\">(</span>currentTime<span class=\"token punctuation\">,</span> effect<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This pushes the accessibility of Animation Worklet deep into “nonsense that only library authors will ever put up with”.</p>\n<p>The idea of using <code class=\"language-text\">localTime</code> almost as an abstraction</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>We already have a Web Animations API that, while limited, is capable enough to perform keyframe animations. In tandem with Houdini’s <a href=\"https://web.dev/css-props-and-vals/\">Properties and Values API</a> (which already enjoys fair cross-browser support) it can finally animate transforms individually, removing my personal final deal-breaker.</p>\n<p>The Animation Worklet API is, for someone who has been writing <a href=\"https://popmotion.io/pure\">various</a> <a href=\"https://popmotion.io/pose\">animation</a> <a href=\"https://framer.com/motion\">libraries</a> for six years, the chance of a lifetime.</p>\n<p>Unless we see some movement on the list above, it isn’t good for anything beyond scroll-driven effects like parallax.</p>","frontmatter":{"title":"Animation Worklet: The Missing Pieces","date":"29 Jan 2020"},"fields":{"slug":"/20200129-animationworklet-the-missing-pieces/","author":"mattperry","description":"There's some glimmers of promise in the current Houdini Animation Worklet API proposal, but it won't be fit for purpose without these changes."}}},"pageContext":{"slug":"/20200129-animationworklet-the-missing-pieces/","author":"mattperry","description":"There's some glimmers of promise in the current Houdini Animation Worklet API proposal, but it won't be fit for purpose without these changes."}}