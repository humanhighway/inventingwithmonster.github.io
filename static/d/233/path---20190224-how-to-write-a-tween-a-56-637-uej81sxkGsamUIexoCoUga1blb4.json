{"data":{"markdownRemark":{"html":"<p>“Don’t reinvent the wheel” is sage advice. It’s almost always better to leverage battle-tested software over rolling your own.</p>\n<p>But if you want to <strong>learn</strong>, forget it. Making your own version of existing libraries can not only help you become a better software developer, but also improve your ability to think critically about the software you do consume.</p>\n<p>In that spirit, by the end of this post we’re going to better understand the inner-workings the tween, the bedrock of UI animation, by making one from scratch.</p>\n<h2 id=\"a-what-now\"><a href=\"#a-what-now\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A what now?</h2>\n<p>A tween! If you haven’t heard of one before, but you have <em>have</em> done animation on the web, it’s likely you’ve used one.</p>\n<p><a href=\"https://greensock.com/\">GreenSock’s TweenMax</a> calls it the <code class=\"language-text\">to</code> function. <a href=\"https://animejs.com\">Anime</a> just calls it <code class=\"language-text\">anime</code>. My own <a href=\"https://popmotion.io\">Popmotion</a> just calls it a <code class=\"language-text\">tween</code>.</p>\n<p>It isn’t exclusive to JavaScript. If you’ve ever written CSS like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> all 100ms ease-out<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s a tween too!</p>\n<p>A tween is just an <strong>animation between two values, over a duration of time</strong>.</p>\n<p>The term began as a abbreviation for “in-betweening”. It’s a process where a cartoon’s lead illustrators would define the <strong>keyframes</strong>, and then pass those off to the cheaper labour. They’d fill in the missing frames with transitional illustrations. In-betweening.</p>\n<p>I first encountered the word “tween” in Flash (ask your parents), where Adobe’s skeuomorphic naming of tools meant that on the timeline you’d place keyframes and Flash would “tween” between those.</p>\n<p>So the term itself is actually an anachronism. In <a href=\"https://facebook.github.io/react-native/docs/animated\">React Native’s Animated</a> they call it a <code class=\"language-text\">timing</code> animation, which might be more immediately obvious to modern readers.</p>\n<p>Back in the Flash days, I used to use Greensock’s TweenMax library to write tween animations. There was something about it that seemed magical, like it was tapping into a special Flash API that I didn’t understand. It was only when I wrote Popmotion that I realised that it was simply a matter of changing values once per frame. Hopefully by the end of this post, the process will be clear.</p>\n<h2 id=\"what-well-make\"><a href=\"#what-well-make\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What we’ll make</h2>\n<p>Enough of the history lesson, let’s take a look at what we’ll have made by the end of this post. Our <code class=\"language-text\">tween</code> function will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">from</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  to<span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n  duration<span class=\"token punctuation\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n  onUpdate<span class=\"token punctuation\">:</span> v <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The easiest way to follow along with this tutorial is to fork <a href=\"https://codepen.io/popmotion/pen/zbGYxp?editors=0011\">this CodePen</a>. It’s set up with an open console and modern JavaScript support.</p>\n<h2 id=\"the-function\"><a href=\"#the-function\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The function</h2>\n<p>Let’s start by writing our function. I’m going to call mine <code class=\"language-text\">tween</code> but you can call yours anything. If there’s a name you prefer, <a href=\"https://twitter.com/mattgperry\">answers on a postcard</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’re going to want a few sensible defaults to make life easier for the users of this function.</p>\n<p>In Popmotion I’ve gone with <code class=\"language-text\">from</code> as <code class=\"language-text\">0</code> and <code class=\"language-text\">to</code> as <code class=\"language-text\">1</code> because the range <code class=\"language-text\">0</code>-<code class=\"language-text\">1</code> comes in handy when writing animations and GPU shaders.</p>\n<p>The full extent of its use is beyond this article but, as <code class=\"language-text\">0</code> represents “none of something” or “zero progress” and <code class=\"language-text\">1</code> represents “all of something” or “completed progress” you can probably imagine that it’s a simple, standard way to think about ranges.</p>\n<p>I also chose a <code class=\"language-text\">duration</code> of <code class=\"language-text\">300</code> milliseconds as I think it strikes a nice balance of being snappy but not sudden.</p>\n<p>To set these defaults, let’s define the first argument as <code class=\"language-text\">config</code> and give it an empty object as a default.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span>config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>We don’t actually need <code class=\"language-text\">config</code>, we want the properties within it! So we can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment\">destructuring</a> to get them out.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">,</span> duration <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>This syntax also gives us an opportunity to set our defaults:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can verify your function is working with these defaults by adding a <code class=\"language-text\">console.log</code> to your function, and then immediately calling it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>duration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The console panel should say <code class=\"language-text\">300</code>. If you pass in your own <code class=\"language-text\">duration</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> duration<span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It will show that instead.</p>\n<p>That’s the skeleton of our function working, now we need to make it run an animation.</p>\n<h2 id=\"the-loop\"><a href=\"#the-loop\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The loop</h2>\n<p>Remember what “tween” is short for: “in-betweening”. We have our <code class=\"language-text\">from</code> and <code class=\"language-text\">to</code> values, those are our keyframes. So now we need to, over the course of <code class=\"language-text\">duration</code>, generate values that are in-between.</p>\n<p>To do this, we’re going to use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\"><code class=\"language-text\">requestAnimationFrame</code> function</a>. This is a function that allows you to ask the browser to run some code before the next frame is rendered.</p>\n<p>Inside the <code class=\"language-text\">tween</code> function, make a new function called <code class=\"language-text\">update</code>. In it, place a <code class=\"language-text\">console.log</code> so we know it’s running. At the end of <code class=\"language-text\">tween</code>, use <code class=\"language-text\">requestAnimationFrame</code> to call <code class=\"language-text\">update</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now when you call <code class=\"language-text\">tween</code>, your console will ping <code class=\"language-text\">&quot;update!&quot;</code>.</p>\n<p>Most monitors render at 60 frames a second. There’s some edge-cases, for instance when iOS is in low-power mode, Safari runs at 30 frames a second. The point is, to make animation appear smooth, you need to call <code class=\"language-text\">requestAnimationFrame</code> once for every single frame!</p>\n<p>At the end of <code class=\"language-text\">update</code>, add the same line of code again. A <code class=\"language-text\">requestAnimationFrame</code>, calling <code class=\"language-text\">update</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Rather than throw your code into a run-away loop, calling <code class=\"language-text\">requestAnimationFrame</code> (<code class=\"language-text\">rAF</code> for short) inside a function that itself has been scheduled with <code class=\"language-text\">rAF</code> will schedule the function for the <em>next</em> frame.</p>\n<p>Now you should see your console filling up with <code class=\"language-text\">&quot;update!&quot;</code> messages. Your animation loop is running!</p>\n<h2 id=\"calculate-elapsed\"><a href=\"#calculate-elapsed\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculate elapsed</h2>\n<p>A <code class=\"language-text\">tween</code> is a duration-based animation, so the key piece of information we need is the progress of the animation, which we derive from the amount of time has elapsed.</p>\n<p>There are two different ways we can calculate <code class=\"language-text\">elapsed</code>.</p>\n<p>The most obvious way is to record the time the animation started, and then every frame see how much time has elapsed since then.</p>\n<p>To do this, we can use the browser’s <code class=\"language-text\">performance.now</code> function. This returns a timestamp, the number of milliseconds since the page session started.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">requestAnimationFrame</code> calls the function given to it with one argument, the latest timestamp. So we can use the difference between that and <code class=\"language-text\">startTime</code> to caluulate <code class=\"language-text\">elapsed</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>currentTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> elapsed <span class=\"token operator\">=</span> currentTime <span class=\"token operator\">-</span> startTime<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The great thing about this approach is its simplicity. But it is quite limited when you want to start extending your tween with extra functionality like <code class=\"language-text\">pause</code> and <code class=\"language-text\">resume</code>. These things aren’t impossible, but they involve changing <code class=\"language-text\">startTime</code> which is a little counter-intuitive.</p>\n<p>There is another way.</p>\n<h3 id=\"accumulative\"><a href=\"#accumulative\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Accumulative</h3>\n<p>With the accumulative method, instead of measuring absolute time since the start of the animation, we take the duration between each frame and add that to an initial <code class=\"language-text\">elapsed</code> value.</p>\n<p>Features like <code class=\"language-text\">pause</code> and <code class=\"language-text\">resume</code> become a matter of simply not integrating the latest frame time. And we can manipulate these packets of time individually to support features like Matrix-style time dilation. These features are beyond the scope of this post, but they will be simplified by using this method.</p>\n<p>Initialise <code class=\"language-text\">elapsed</code> as <code class=\"language-text\">0</code> when the animation starts.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we want to measure the time since the previous frame, we need to store a <code class=\"language-text\">prevTime</code> variable. Initialise <code class=\"language-text\">prevTime</code> with <code class=\"language-text\">performance.now()</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> prevTime <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, at the head of <code class=\"language-text\">update</code>, we can calculate the frame duration and add that to <code class=\"language-text\">elapsed</code>. Then, we save the new <code class=\"language-text\">currentTime</code> to <code class=\"language-text\">prevTime</code> so we can use it in the following frame’s calculations.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> prevTime <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>currentTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  elapsed <span class=\"token operator\">+=</span> currentTime <span class=\"token operator\">-</span> prevTime<span class=\"token punctuation\">;</span>\n  prevTime <span class=\"token operator\">=</span> currentTime<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The resulting code looks similar to the previous approach, but the small added complexity of another variable here does pays off in reduced complexity when you want to expand this function.</p>\n<h2 id=\"get-progress\"><a href=\"#get-progress\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get progress</h2>\n<p>Now we have an <code class=\"language-text\">elapsed</code> value, we can figure out <code class=\"language-text\">progress</code>. <code class=\"language-text\">progress</code> is a value between <code class=\"language-text\">0</code> and <code class=\"language-text\">1</code>, and as mentioned earlier <code class=\"language-text\">0</code> represents no progress and <code class=\"language-text\">1</code> represents a completed tween.</p>\n<p>The calculation for this is just:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> elapsed <span class=\"token operator\">/</span> duration<span class=\"token punctuation\">;</span></code></pre></div>\n<p>To explain, think of an animation of <code class=\"language-text\">1000</code> millisecond duration that has been running for <code class=\"language-text\">500</code> milliseconds:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> <span class=\"token number\">500</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0.5</span></code></pre></div>\n<p><code class=\"language-text\">0.5</code> represents half way through the animation. We want to cap <code class=\"language-text\">progress</code> to no greater than <code class=\"language-text\">1</code>, so for this we can use <code class=\"language-text\">Math.min</code>, which returns the smallest of the numbers provided to it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>elasped <span class=\"token operator\">/</span> duration<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We also want to automatically stop the tween when <code class=\"language-text\">progress</code> is <code class=\"language-text\">1</code>, so let’s wrap our self-calling <code class=\"language-text\">rAF</code> with a check that does just that:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>currentTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  elapsed <span class=\"token operator\">+=</span> currentTime <span class=\"token operator\">-</span> prevTime<span class=\"token punctuation\">;</span>\n  prevTime <span class=\"token operator\">=</span> currentTime<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>elasped <span class=\"token operator\">/</span> duration<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>progress <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"calculate-tweened-value\"><a href=\"#calculate-tweened-value\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculate tweened value</h2>\n<p>Now we’re ready to use <code class=\"language-text\">progress</code> to calculate our tweened values!</p>\n<p>First, we need to calculate the distance (or the <code class=\"language-text\">delta</code>) between <code class=\"language-text\">to</code> and <code class=\"language-text\">from</code>. We can do this by subtracting <code class=\"language-text\">to</code> from <code class=\"language-text\">from</code> at the start of the <code class=\"language-text\">tween</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> delta <span class=\"token operator\">=</span> to <span class=\"token operator\">-</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This gives us a <code class=\"language-text\">delta</code> value which, when we add back to <code class=\"language-text\">from</code>, will return us <code class=\"language-text\">to</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> latest <span class=\"token operator\">=</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">+</span> progress <span class=\"token operator\">*</span> delta<span class=\"token punctuation\">;</span></code></pre></div>\n<p>The way this works is, when we multiply <code class=\"language-text\">delta</code> by <code class=\"language-text\">0</code> (no progress), <code class=\"language-text\">latest</code> will be the same as <code class=\"language-text\">from</code>. When we multiply <code class=\"language-text\">delta</code> by <code class=\"language-text\">1</code> (completed tween) and add that to <code class=\"language-text\">from</code>, we receive <code class=\"language-text\">to</code>.</p>\n<p>So for all the <code class=\"language-text\">progress</code> values in between the two, we receive values that are also between the two.</p>\n<p>Now if you <code class=\"language-text\">console.log</code> <code class=\"language-text\">latest</code>, your tween works! Here’s what you should have:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> delta <span class=\"token operator\">=</span> to <span class=\"token operator\">-</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> prevTime <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>currentTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    elapsed <span class=\"token operator\">+=</span> currentTime <span class=\"token operator\">-</span> prevTime<span class=\"token punctuation\">;</span>\n    prevTime <span class=\"token operator\">=</span> currentTime<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>elapsed <span class=\"token operator\">/</span> duration<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> latest <span class=\"token operator\">=</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">+</span> progress <span class=\"token operator\">*</span> delta<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>progress <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"hook-it-up\"><a href=\"#hook-it-up\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hook it up!</h2>\n<p>Of course, animations are no good if they don’t animate anything. So we need to provide a way for people to define a render target which, in this case, is going to be the ball on the CodePen.</p>\n<p>Add <code class=\"language-text\">onUpdate</code> to the config:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> onUpdate <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>This is going to be a function that a user can configure to fire once every frame.</p>\n<p>On the line after we set <code class=\"language-text\">latest</code>, pass it <code class=\"language-text\">latest</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>onUpdate<span class=\"token punctuation\">)</span> <span class=\"token function\">onUpdate</span><span class=\"token punctuation\">(</span>latest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we can <code class=\"language-text\">tween</code> to animate the ball.</p>\n<p>After your <code class=\"language-text\">tween</code> function, cache a reference to the <code class=\"language-text\">#ball</code> element.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ball <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ball\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then we can define an <code class=\"language-text\">onUpdate</code> in our call to <code class=\"language-text\">tween</code> that uses its output to change <code class=\"language-text\">opacity</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  duration<span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  onUpdate<span class=\"token punctuation\">:</span> v <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    ball<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>opacity <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Success! You can animate any value this way. For instance <code class=\"language-text\">translateX</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">from</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  to<span class=\"token punctuation\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n  onUpdate<span class=\"token punctuation\">:</span> v <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    ball<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translateX(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>v<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px) translateZ(0)`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"easing\"><a href=\"#easing\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Easing</h2>\n<p>When you animate <code class=\"language-text\">x</code> you might notice something about the motion that feels a little stifled. That’s because we’re doing a <code class=\"language-text\">linear</code> tween, which basically means <code class=\"language-text\">progress</code> has a linear relationship to time.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bce9abc1d93705a059553956a146941f/8a7aa/201902-easing-linear.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 650px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABMklEQVQ4y42SwVKDMBCGOflWfXVPPTi9eGKqM9JSkSJQJdZSgexmTVI2AgVqZj52+Tf7J4R4RHTXpfppXA6ALldKWUweQeX0WmGv39MPn9ENNn6kwtdmTmPMO7axVODLNueawRhejexN0Nw4aXakRmvGEBm9ko3xNkMpoadhGw/Y4FqWVz2M26EuWMyIgpRAAhdMl01zbOhJltTt6UbeYU88fh9ptXx0Gptl/zAbNRSioOX9yuZslmJNz/J802zUEBEoWEcE9giJ3mfMZg27k+MwJ2qQEmumP1P9GQwZO0N10S7D5PsgUzFUakO14voU3MMYQ2B0zcZNmMJDGINIBOT7ArL4E5LX3OaM0c6nqtdn8CZvr9Tn2aI025cdFYcve9v0D7dMXexFF73aYqjNMZz/C6Fp2vgzTVM+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"A graph representing linear easing\"\n        title=\"\"\n        src=\"/static/bce9abc1d93705a059553956a146941f/6b671/201902-easing-linear.png\"\n        srcset=\"/static/bce9abc1d93705a059553956a146941f/f7a0c/201902-easing-linear.png 163w,\n/static/bce9abc1d93705a059553956a146941f/608ba/201902-easing-linear.png 325w,\n/static/bce9abc1d93705a059553956a146941f/6b671/201902-easing-linear.png 650w,\n/static/bce9abc1d93705a059553956a146941f/1ee70/201902-easing-linear.png 975w,\n/static/bce9abc1d93705a059553956a146941f/8a7aa/201902-easing-linear.png 1264w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>In other words, <code class=\"language-text\">progress</code> changes at a constant rate throughout the animation.</p>\n<p>In the real world, stuff doesn’t often move at a constant rate. It tends accelerates and/or decelerates.</p>\n<p>We can replicate this kind of motion in a tween using <strong>easing</strong>. Easing functions take a <code class=\"language-text\">progress</code> value and return a new one. For instance, the <code class=\"language-text\">linear</code> easing shown above looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">linear</span><span class=\"token punctuation\">(</span>progress<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> progress<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The easing effects these functions impart vary, but you can play with different easing curves at <a href=\"http://cubic-bezier.com/#.17,.67,.83,.67\">Lea Verou’s Cubic Bezier playground</a> to get a feel for how they can affect the animation.</p>\n<p>A full understanding of easing is a whole post of its own. But for now let’s make our <code class=\"language-text\">tween</code> capable of accepting easing functions.</p>\n<p>Add this <code class=\"language-text\">easeOut</code> easing to the top of your JavaScript panel:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">easeOut</span><span class=\"token punctuation\">(</span>progress<span class=\"token punctuation\">,</span> power <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> progress<span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> power<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This starts motion fast, and gradually slows over the course of the animation.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3b3895ac8d0264925e0f21344cc38dd6/8a7aa/201902-easing-ease-out.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 650px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABQ0lEQVQ4y31SXVfCMAzd0/4Vf90nXvTFp6JHQUAZnA1wYwjDNR+m3YpdGcs5l4Sb9CZpFzFz7ONS1dcYAGNq4yNBrPQpDuuBqPM/kh/lQETW79NCiVjD0z9vcCJQO6xVAr8KWt7PG8Eby1ZFH80rUTdIJa6434wgOkgn65N5hqABqeVz1Cjr4kG8X++fcbhOKAkLO8ksZa3BxgVqnujTNWc8trU+50/YIctjyU/jZxvX0lwFYmHzvpU7xUWR8/jh0cZvIlbKhKHYkN0IAgIvX754r2v+wObqMZiMgpV7BX3RbLHjSXXkytw39QsN3SE1XGMmnkzXNNNncrkhuDMORhAcZDXr3xcpvC5TyDcFZOscsuQbNp9b2ErsYLjzz8XWU3vOILp7u/IW5j2oxXy65Hx3sF8b1g3uPcrIh3QbhdwQwvo/UE7azM2SP68AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"A graph representing ease out easing\"\n        title=\"\"\n        src=\"/static/3b3895ac8d0264925e0f21344cc38dd6/6b671/201902-easing-ease-out.png\"\n        srcset=\"/static/3b3895ac8d0264925e0f21344cc38dd6/f7a0c/201902-easing-ease-out.png 163w,\n/static/3b3895ac8d0264925e0f21344cc38dd6/608ba/201902-easing-ease-out.png 325w,\n/static/3b3895ac8d0264925e0f21344cc38dd6/6b671/201902-easing-ease-out.png 650w,\n/static/3b3895ac8d0264925e0f21344cc38dd6/1ee70/201902-easing-ease-out.png 975w,\n/static/3b3895ac8d0264925e0f21344cc38dd6/8a7aa/201902-easing-ease-out.png 1264w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>In your <code class=\"language-text\">tween</code> function, make this the default <code class=\"language-text\">ease</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">tween</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">from</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  to <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  duration <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n  ease <span class=\"token operator\">=</span> easeOut<span class=\"token punctuation\">,</span>\n  onUpdate\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>I prefer using this as a default over <code class=\"language-text\">linear</code> because most UI animations should happen as a result of a user’s action. To make it feel like the user is imparting their own energy into the UI, I prefer to start those animations fast and let them slow down on their own.</p>\n<p>If an animation is happening <strong>not</strong> as a direct result of a user’s input, an easing function that starts a little slower is better, to grab the user’s attention before they miss what’s changing.</p>\n<p>To use this <code class=\"language-text\">easeOut</code> easing in our animations we need to replace the <code class=\"language-text\">progress</code> we use in our <code class=\"language-text\">latest</code> calculation with the amended version returned from <code class=\"language-text\">ease</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> latest <span class=\"token operator\">=</span> <span class=\"token keyword\">from</span> <span class=\"token operator\">+</span> <span class=\"token function\">ease</span><span class=\"token punctuation\">(</span>progress<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> delta<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now the animation feels a bit more true to life.</p>\n<h2 id=\"next-steps\"><a href=\"#next-steps\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next steps</h2>\n<p>There’s plenty we can do to improve the usability of our tween function. Here’s some ideas for you to explore:</p>\n<ul>\n<li>Adding support for units, colors and other value types (hint: you can use a function like <a href=\"https://popmotion.io/popcorn/api/interpolate/\">Popcorn’s <code class=\"language-text\">interpolate</code></a>)</li>\n<li>Return an API with methods like <code class=\"language-text\">pause</code>, <code class=\"language-text\">resume</code>, <code class=\"language-text\">stop</code> and <code class=\"language-text\">seek</code>. How do these affect our choice of calculating <code class=\"language-text\">elapsed</code>?</li>\n</ul>","frontmatter":{"title":"Learn how a tween animation works by building one","date":"03 Mar 2019"},"fields":{"slug":"/20190224-how-to-write-a-tween/","author":"mattperry","description":"The best way to learn something is by doing. In this post we'll learn how a duration-based tween animation works by writing one together."}}},"pageContext":{"slug":"/20190224-how-to-write-a-tween/","author":"mattperry","description":"The best way to learn something is by doing. In this post we'll learn how a duration-based tween animation works by writing one together."}}